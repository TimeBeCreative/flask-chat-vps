<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="{{ url_for('static', filename ='style.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename ='style.css') }}">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat with {{ recipient_name }}</title>
        <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>

        <style>
            .message-container {
                display: flex;
                align-items: left;
            }
            .message {
                margin-left: 10px;
            }
            .avatar {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                margin-right: 10px;
            }
        </style>
    </head>
    <body>
        <h1>Chat with {{ recipient_name }}</h1>

        <ul id="messages"></ul>

        <input id="message" autocomplete="off">
        <button onclick="sendMessage()">Send</button>
        <button onclick="window.location.href='/'">Back to Chats</button>

        <script>
            var socket = io("web-production-b946f.up.railway.app", { transports: ['websocket', 'polling'] });

            socket.on('message', function(msg) {
                var li = document.createElement("li");
                li.classList.add("message-container");

                li.innerHTML = `
                    <img class="avatar" src="${msg.avatar_url}" alt="Avatar">
                    <div class="message-bubble">
                        <div class="username">${msg.username}:</div>
                        <div class="text">${msg.message}</div>
                    </div>
                `;

               // const avatarUrl = msg.avatar_url;
              // // const username = msg.username;
              //  const message = msg.message;

               // var messageContainer = document.createElement("div");
              //  messageContainer.classList.add("message-container");

             //   var avatarElement = document.createElement("img");
             //   avatarElement.classList.add("avatar");
             //   avatarElement.src = avatarUrl;



               // var username = msg.split(':')[0];
             //   var message = msg.split(':').slice(1).join(':');



             //   var nameElement = document.createElement("span");
              //  nameElement.classList.add("username");
              //  nameElement.textContent = username + ": ";

             //   var messageElement = document.createElement("span");
            //    messageElement.classList.add("message");
              //  messageElement.textContent = message;




           //     messageContainer.appendChild(avatarElement);
           //     messageContainer.appendChild(nameElement);
          //      messageContainer.appendChild(messageElement);

           //    // li.appendChild(nameElement);

            //    li.appendChild(messageContainer);
                document.getElementById("messages").appendChild(li);
                scrollToBottom();

            });

            function sendMessage() {
                var msg = document.getElementById("message").value;
                if (msg.trim() === "") return;

                socket.emit('message', msg);
                document.getElementById("message").value = "";
            }
            function scrollToBottom() {
                const messageContainer = document.getElementById('messages');
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }
        </script>

    </body>
</html>